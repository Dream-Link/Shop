<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§¶‡•Å‡§ï‡§æ‡§® ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü ‡§ê‡§™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans Devanagari', sans-serif;
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
            body {
                background: white !important;
                color: black !important;
            }
        }
        
        .dark {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        .dark .bg-white {
            background-color: #2d2d2d !important;
        }
        
        .dark .bg-gray-50 {
            background-color: #3d3d3d !important;
        }
        
        .dark .bg-gray-100 {
            background-color: #4d4d4d !important;
        }
        
        .dark .text-gray-900 {
            color: #ffffff !important;
        }
        
        .dark .text-gray-700 {
            color: #d1d5db !important;
        }
        
        .dark .text-gray-600 {
            color: #9ca3af !important;
        }
        
        .dark .border-gray-300 {
            border-color: #6b7280 !important;
        }
        
        .dark .border-gray-200 {
            border-color: #4b5563 !important;
        }
        
        .customer-menu-btn {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 transition-colors duration-300">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200 no-print">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <h1 id="shopTitle" class="text-xl font-bold text-gray-900 cursor-pointer hover:text-blue-600" onclick="editShopTitle()">‡§¶‡•Å‡§ï‡§æ‡§® ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</h1>
                    
                    <!-- Menu Button -->
                    <div class="relative">
                        <button id="menuBtn" class="p-2 rounded-md hover:bg-gray-100 focus:outline-none">
                            <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zM12 13a1 1 0 110-2 1 1 0 010 2zM12 20a1 1 0 110-2 1 1 0 010 2z"></path>
                            </svg>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="menuDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-50 border border-gray-200">
                            <div class="py-1">
                                <button id="printAllItems" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    üìã ‡§∏‡§≠‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç
                                </button>
                                <button id="printBahikhata" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    üìñ ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç (PDF)
                                </button>
                                <button id="printDetailedBahikhata" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    üìù ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç (PDF)
                                </button>
                                <button id="editTitle" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    ‚úèÔ∏è ‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç
                                </button>
                                <hr class="my-1">
                                <div class="px-4 py-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§•‡•Ä‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
                                    <select id="themeSelect" class="w-full p-2 border border-gray-300 rounded-md text-sm">
                                        <option value="light">Light</option>
                                        <option value="dark">Dark</option>
                                        <option value="auto">Auto (‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-white border-b border-gray-200 no-print">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex">
                    <button id="homeTab" class="tab-btn flex-1 text-center border-b-2 border-blue-500 text-blue-600 py-4 px-1 text-sm font-medium">
                        üè† ‡§π‡•ã‡§Æ
                    </button>
                    <button id="accountTab" class="tab-btn flex-1 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium">
                        üìñ ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ
                    </button>
                    <button id="calculatorTab" class="tab-btn flex-1 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium">
                        üßÆ ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            
            <!-- Home Mode -->
            <div id="homeMode" class="tab-content">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-semibold text-gray-900">‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•Ä ‡§¶‡§∞ ‡§∏‡•Ç‡§ö‡•Ä</h2>
                        <div class="flex items-center gap-3">
                            <!-- Search Icon -->
                            <button id="searchItemBtn" class="p-2 rounded-md hover:bg-gray-100 text-gray-600" title="‡§ñ‡•ã‡§ú‡•á‡§Ç">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            <!-- Sort Order Icon -->
                            <div class="relative">
                                <button id="sortItemBtn" class="p-2 rounded-md hover:bg-gray-100 text-gray-600" title="‡§ï‡•ç‡§∞‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path>
                                    </svg>
                                </button>
                                <select id="itemSortOrder" class="hidden absolute right-0 mt-1 p-2 border border-gray-300 rounded-md text-sm bg-white shadow-lg z-10">
                                    <option value="name">‡§®‡§æ‡§Æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞</option>
                                    <option value="date">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞</option>
                                </select>
                            </div>
                            <!-- Add Item Icon -->
                            <button id="addItemBtn" class="p-2 rounded-md bg-blue-500 hover:bg-blue-600 text-white" title="‡§µ‡§∏‡•ç‡§§‡•Å ‡§ú‡•ã‡§°‡§º‡•á‡§Ç">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search Input (Hidden by default) -->
                    <div id="itemSearchContainer" class="hidden mb-4">
                        <input type="text" id="itemSearchInput" class="w-full p-3 border border-gray-300 rounded-md" placeholder="‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ñ‡•ã‡§ú‡•á‡§Ç...">
                    </div>
                    
                    <div id="itemsList" class="space-y-3">
                        <!-- Items will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Account Mode -->
            <div id="accountMode" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-semibold text-gray-900">‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ</h2>
                        <div class="flex items-center gap-3">
                            <!-- Search Icon -->
                            <button id="searchCustomerBtn" class="p-2 rounded-md hover:bg-gray-100 text-gray-600" title="‡§ñ‡•ã‡§ú‡•á‡§Ç">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            <!-- Sort Order Icon -->
                            <div class="relative">
                                <button id="sortCustomerBtn" class="p-2 rounded-md hover:bg-gray-100 text-gray-600" title="‡§ï‡•ç‡§∞‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path>
                                    </svg>
                                </button>
                                <select id="customerSortOrder" class="hidden absolute right-0 mt-1 p-2 border border-gray-300 rounded-md text-sm bg-white shadow-lg z-10">
                                    <option value="recent">‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§™‡§π‡§≤‡•á</option>
                                    <option value="name">‡§®‡§æ‡§Æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞</option>
                                </select>
                            </div>

                            <!-- Add Customer Icon -->
                            <button id="addCustomerBtn" class="p-2 rounded-md bg-green-500 hover:bg-green-600 text-white" title="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search Input (Hidden by default) -->
                    <div id="customerSearchContainer" class="hidden mb-4">
                        <input type="text" id="customerSearchInput" class="w-full p-3 border border-gray-300 rounded-md" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ñ‡•ã‡§ú‡•á‡§Ç...">
                    </div>
                    
                    <div id="customersList" class="space-y-4">
                        <!-- Customers will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Calculator Mode -->
            <div id="calculatorMode" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow p-6 max-w-md mx-auto">
                    <div class="calculator">
                        <div class="mb-4">
                            <div id="calcSteps" class="mb-2 p-3 bg-blue-50 border border-blue-200 rounded-md min-h-[60px]">
                                <div class="text-sm text-blue-600 font-medium mb-1">‡§ó‡§£‡§®‡§æ ‡§ï‡•á ‡§ö‡§∞‡§£:</div>
                                <div id="calcStepsContent" class="text-lg font-bold text-blue-800">0</div>
                            </div>
                            <input id="calcDisplay" type="text" class="w-full p-4 text-right text-2xl font-mono bg-gray-100 border border-gray-300 rounded-md" oninput="handleDisplayInput()" onkeydown="handleKeyDown(event)">
                        </div>
                        <div class="grid grid-cols-4 gap-3">
                            <button class="calc-btn bg-red-500 hover:bg-red-600 text-white p-4 rounded-md text-xl font-semibold" onclick="clearCalculator()">C</button>
                            <button class="calc-btn bg-orange-500 hover:bg-orange-600 text-white p-4 rounded-md text-xl font-semibold" onclick="deleteLast()">‚å´</button>
                            <button class="calc-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('/')">/</button>
                            <button class="calc-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('*')">√ó</button>
                            
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('7')">7</button>
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('8')">8</button>
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('9')">9</button>
                            <button class="calc-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('-')">-</button>
                            
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('4')">4</button>
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('5')">5</button>
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('6')">6</button>
                            <button class="calc-btn bg-green-500 hover:bg-green-600 text-white p-4 rounded-md text-xl font-semibold row-span-2" onclick="appendToDisplay('+')">+</button>
                            
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('1')">1</button>
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('2')">2</button>
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('3')">3</button>
                            
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold col-span-2" onclick="appendToDisplay('0')">0</button>
                            <button class="calc-btn bg-gray-200 hover:bg-gray-300 text-gray-900 p-4 rounded-md text-xl font-semibold" onclick="appendToDisplay('.')">.</button>
                            <button class="calc-btn bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-md text-xl font-semibold" onclick="calculate()">=</button>
                        </div>
                        
                        <div class="mt-4 flex gap-2">
                            <button id="calcHistoryBtn" class="p-3 bg-gray-500 hover:bg-gray-600 text-white rounded-md" title="‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç" onclick="openCalcHistory()">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </button>
                            <button id="addToBahikhataBtn" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-md font-semibold" onclick="openCalcToBahikhata()">
                                üìñ ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Item Modal -->
    <div id="addItemModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <h3 id="itemModalTitle" class="text-lg font-semibold mb-4">‡§®‡§à ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
            <form id="addItemForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="itemName" class="w-full p-3 border border-gray-300 rounded-md" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§¶‡§∞ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</label>
                    <div id="priceVariants" class="space-y-3">
                        <div class="flex gap-2 items-center price-variant">
                            <input type="number" class="w-32 p-2 border border-gray-300 rounded-md variant-price" placeholder="‡§¶‡§∞ (‚Çπ)" required>
                            <select class="flex-1 p-2 border border-gray-300 rounded-md variant-type">
                                <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã">‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã</option>
                                <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó">‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó</option>
                                <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®">‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®</option>
                                <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü">‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü</option>
                                <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞">‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞</option>
                                <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞">‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞</option>
                                <option value="‡§Ö‡§®‡•ç‡§Ø">‡§Ö‡§®‡•ç‡§Ø</option>
                            </select>
                            <input type="text" class="flex-1 p-2 border border-gray-300 rounded-md custom-type hidden" placeholder="‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞">
                            <button type="button" class="text-red-500 hover:text-red-700 remove-variant" onclick="removeVariant(this)">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="button" id="addVariant" class="mt-2 text-blue-500 hover:text-blue-700 text-sm">+ ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
                </div>
                
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button type="button" id="cancelAddItem" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button type="button" id="deleteItem" class="hidden bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-md" onclick="deleteItem()">‡§π‡§ü‡§æ‡§è‡§Ç</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
            <form id="addCustomerForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="customerName" class="w-full p-3 border border-gray-300 rounded-md" required>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md">‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
                    <button type="button" id="cancelAddCustomer" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Multiple Transactions Modal -->
    <div id="addTransactionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
            <form id="addTransactionForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§≤‡•á‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)</label>
                    <input type="text" id="buyerName" class="w-full p-3 border border-gray-300 rounded-md" placeholder="‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü: ‡§ñ‡§æ‡§§‡§æ ‡§ß‡§æ‡§∞‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</label>
                    <div id="transactionItems" class="space-y-3">
                        <!-- Transaction items will be added here -->
                    </div>
                </div>
                
                <div class="mb-4 p-3 bg-gray-50 rounded-md">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</span>
                        <span id="totalAmount" class="text-lg font-bold text-green-600">‚Çπ0.00</span>
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md">‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
                    <button type="button" id="cancelAddTransaction" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Calculator to Bahikhata Modal -->
    <div id="calcToBahikhataModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
            <form id="calcToBahikhataForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç ‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</label>
                    <div class="relative">
                        <input type="text" id="calcCustomerInput" class="w-full p-3 border border-gray-300 rounded-md" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç ‡§Ø‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç" required>
                        <div id="calcCustomerDropdown" class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-40 overflow-y-auto">
                            <!-- Customer options will be populated here -->
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§∞‡§æ‡§∂‡§ø</label>
                    <input type="number" id="calcAmount" class="w-full p-3 border border-gray-300 rounded-md" step="0.01" readonly>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</label>
                    <textarea id="calcItemDescription" class="w-full p-3 border border-gray-300 rounded-md" rows="3" placeholder="‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≤‡§ø‡§ñ‡•á‡§Ç..."></textarea>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md">‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
                    <button type="button" id="cancelCalcToBahikhata" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Send Notice Modal -->
    <div id="sendNoticeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <h3 class="text-lg font-semibold mb-4">‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§∏</h3>
            <div id="noticeContent" class="border border-gray-300 rounded-md p-4 mb-4 bg-gray-50">
                <!-- Notice content will be generated here -->
            </div>
            <div class="flex gap-3">
                <button id="printNotice" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md">üñ®Ô∏è ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                <button id="saveNoticeImage" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md">üíæ ‡§á‡§Æ‡•á‡§ú ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                <button id="cancelNotice" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <!-- Calculator History Modal -->
    <div id="calcHistoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[80vh] overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4">‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞ ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h3>
            <div id="calcHistoryContent" class="space-y-3 mb-4">
                <!-- History items will be loaded here -->
            </div>
            <div class="flex gap-3">
                <button id="clearCalcHistory" class="flex-1 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-md">‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç</button>
                <button id="closeCalcHistory" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <!-- Edit Shop Title Modal -->
    <div id="editTitleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç</h3>
            <form id="editTitleForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡§®‡§Ø‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="newShopTitle" class="w-full p-3 border border-gray-300 rounded-md" required>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button type="button" id="cancelEditTitle" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let items = JSON.parse(localStorage.getItem('shopItems') || '[]');
        let customers = JSON.parse(localStorage.getItem('shopCustomers') || '[]');
        let calcHistory = JSON.parse(localStorage.getItem('calcHistory') || '[]');
        let currentCustomerId = null;
        let editingItemIndex = null;
        let shopTitle = localStorage.getItem('shopTitle') || '‡§¶‡•Å‡§ï‡§æ‡§® ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü';
        let filteredItems = [];
        let filteredCustomers = [];

        // Shop Title Management
        function initShopTitle() {
            document.getElementById('shopTitle').textContent = shopTitle;
        }

        function editShopTitle() {
            document.getElementById('newShopTitle').value = shopTitle;
            document.getElementById('editTitleModal').classList.remove('hidden');
        }

        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('shopTheme') || 'light';
            document.getElementById('themeSelect').value = savedTheme;
            applyTheme(savedTheme);
        }

        function applyTheme(theme) {
            const body = document.body;
            body.classList.remove('dark');
            
            if (theme === 'dark') {
                body.classList.add('dark');
            } else if (theme === 'auto') {
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    body.classList.add('dark');
                }
            }
            
            localStorage.setItem('shopTheme', theme);
        }

        // Tab Management
        function initTabs() {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => {
                        t.classList.remove('border-blue-500', 'text-blue-600');
                        t.classList.add('border-transparent', 'text-gray-500');
                    });

                    // Add active class to clicked tab
                    tab.classList.remove('border-transparent', 'text-gray-500');
                    tab.classList.add('border-blue-500', 'text-blue-600');

                    // Hide all content
                    contents.forEach(content => content.classList.add('hidden'));

                    // Show corresponding content
                    const targetId = tab.id.replace('Tab', 'Mode');
                    document.getElementById(targetId).classList.remove('hidden');
                });
            });
        }

        // Items Management
        function saveItems() {
            localStorage.setItem('shopItems', JSON.stringify(items));
        }

        function saveCustomers() {
            localStorage.setItem('shopCustomers', JSON.stringify(customers));
        }

        function renderItems() {
            const itemsList = document.getElementById('itemsList');
            itemsList.innerHTML = '';

            // Use filtered items if search is active, otherwise use all items
            const itemsToShow = filteredItems.length > 0 || document.getElementById('itemSearchInput')?.value ? filteredItems : items;

            if (itemsToShow.length === 0) {
                const searchValue = document.getElementById('itemSearchInput')?.value;
                if (searchValue) {
                    itemsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡§ï‡•ã‡§à ‡§µ‡§∏‡•ç‡§§‡•Å ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§ ‡§ñ‡•ã‡§ú ‡§¨‡§¶‡§≤‡§ï‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§</p>';
                } else {
                    itemsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡§ï‡•ã‡§à ‡§µ‡§∏‡•ç‡§§‡•Å ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§ ‡§®‡§à ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è + ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç‡•§</p>';
                }
                return;
            }

            // Sort items based on selected order
            const sortOrder = document.getElementById('itemSortOrder')?.value || 'name';
            let sortedItems = [...itemsToShow];
            
            if (sortOrder === 'name') {
                sortedItems.sort((a, b) => a.name.localeCompare(b.name, 'hi'));
            } else if (sortOrder === 'date') {
                sortedItems.sort((a, b) => new Date(b.dateAdded || 0) - new Date(a.dateAdded || 0));
            }

            sortedItems.forEach((item, originalIndex) => {
                const actualIndex = items.findIndex(i => i === item);
                const itemDiv = document.createElement('div');
                itemDiv.className = 'border border-gray-200 rounded-md p-4 hover:bg-gray-50';
                
                let variantsHtml = '';
                if (item.variants && item.variants.length > 0) {
                    variantsHtml = item.variants.map(variant => 
                        `<div class="text-sm mb-1">
                            <div class="text-left">
                                ${variant.price > 0 ? `<span class="font-bold text-lg text-green-700">‚Çπ${Math.round(variant.price)}</span>` : ''}
                                <span class="text-gray-600 ${variant.price > 0 ? 'ml-2' : ''}">${variant.type}</span>
                            </div>
                        </div>`
                    ).join('');
                } else {
                    // Legacy support for old format
                    const price = item.price || 0;
                    variantsHtml = `<div class="text-sm mb-1">
                        <div class="text-left">
                            ${price > 0 ? `<span class="font-bold text-lg text-green-700">‚Çπ${Math.round(price)}</span>` : ''}
                            <span class="text-gray-600 ${price > 0 ? 'ml-2' : ''}">${item.type || '‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø'}</span>
                        </div>
                    </div>`;
                }
                
                itemDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-semibold text-gray-900 text-lg">${item.name}</h3>
                        <div class="flex gap-2">
                            <button onclick="editItem(${actualIndex})" class="text-blue-500 hover:text-blue-700 p-1">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="confirmDeleteItem(${actualIndex})" class="text-red-500 hover:text-red-700 p-1">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="space-y-1">
                        ${variantsHtml}
                    </div>
                `;
                itemsList.appendChild(itemDiv);
            });
        }

        function editItem(index) {
            editingItemIndex = index;
            const item = items[index];
            
            document.getElementById('itemModalTitle').textContent = '‡§µ‡§∏‡•ç‡§§‡•Å ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç';
            document.getElementById('itemName').value = item.name;
            document.getElementById('deleteItem').classList.remove('hidden');
            
            // Clear existing variants
            const variantsContainer = document.getElementById('priceVariants');
            variantsContainer.innerHTML = '';
            
            if (item.variants && item.variants.length > 0) {
                item.variants.forEach(variant => {
                    addVariantRow(variant.type, variant.price);
                });
            } else {
                // Legacy support
                addVariantRow(item.type || '‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', item.price);
            }
            
            document.getElementById('addItemModal').classList.remove('hidden');
        }

        function deleteItem() {
            if (editingItemIndex !== null && confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                items.splice(editingItemIndex, 1);
                saveItems();
                renderItems();
                document.getElementById('addItemModal').classList.add('hidden');
                resetItemForm();
            }
        }

        function resetItemForm() {
            editingItemIndex = null;
            document.getElementById('itemModalTitle').textContent = '‡§®‡§à ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ú‡•ã‡§°‡§º‡•á‡§Ç';
            document.getElementById('deleteItem').classList.add('hidden');
            document.getElementById('addItemForm').reset();
            
            // Reset to single variant
            const variantsContainer = document.getElementById('priceVariants');
            variantsContainer.innerHTML = '';
        }

        function addVariantRow(type = '‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', price = '') {
            const variantsContainer = document.getElementById('priceVariants');
            const variantDiv = document.createElement('div');
            variantDiv.className = 'flex gap-2 items-center price-variant';
            variantDiv.innerHTML = `
                <select class="flex-1 p-2 border border-gray-300 rounded-md variant-type">
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞</option>
                    <option value="‡§Ö‡§®‡•ç‡§Ø" ${!['‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó', '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®', '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü', '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞', '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞'].includes(type) ? 'selected' : ''}>‡§Ö‡§®‡•ç‡§Ø</option>
                </select>
                <input type="text" class="flex-1 p-2 border border-gray-300 rounded-md custom-type ${!['‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó', '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®', '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü', '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞', '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞'].includes(type) ? '' : 'hidden'}" placeholder="‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞" value="${!['‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó', '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®', '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü', '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞', '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞'].includes(type) ? type : ''}">
                <input type="number" class="w-24 p-2 border border-gray-300 rounded-md variant-price" step="0.01" placeholder="‡§¶‡§∞" value="${price}" required>
                <button type="button" class="text-red-500 hover:text-red-700 remove-variant" onclick="removeVariant(this)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;
            variantsContainer.appendChild(variantDiv);
            
            // Add event listener for variant type change
            const select = variantDiv.querySelector('.variant-type');
            const customInput = variantDiv.querySelector('.custom-type');
            select.addEventListener('change', function() {
                if (this.value === '‡§Ö‡§®‡•ç‡§Ø') {
                    customInput.classList.remove('hidden');
                    customInput.required = true;
                } else {
                    customInput.classList.add('hidden');
                    customInput.required = false;
                    customInput.value = '';
                }
            });
        }

        function removeVariant(button) {
            const variants = document.querySelectorAll('.price-variant');
            if (variants.length > 1) {
                button.closest('.price-variant').remove();
            }
        }

        function renderCustomers() {
            const customersList = document.getElementById('customersList');
            customersList.innerHTML = '';

            // Use filtered customers if search is active, otherwise use all customers
            const customersToShow = filteredCustomers.length > 0 || document.getElementById('customerSearchInput')?.value ? filteredCustomers : customers;

            if (customersToShow.length === 0) {
                const searchValue = document.getElementById('customerSearchInput')?.value;
                if (searchValue) {
                    customersList.innerHTML = '<p class="text-gray-500 text-center py-8">‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§ñ‡•ã‡§ú ‡§¨‡§¶‡§≤‡§ï‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§</p>';
                } else {
                    customersList.innerHTML = '<p class="text-gray-500 text-center py-8">‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è + ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç‡•§</p>';
                }
                return;
            }

            // Sort customers based on selected order
            const sortOrder = document.getElementById('customerSortOrder')?.value || 'recent';
            let sortedCustomers = [...customersToShow];
            
            if (sortOrder === 'name') {
                sortedCustomers.sort((a, b) => a.name.localeCompare(b.name, 'hi'));
            } else if (sortOrder === 'recent') {
                sortedCustomers.sort((a, b) => {
                    const aLastUpdate = a.lastUpdated || a.dateAdded || 0;
                    const bLastUpdate = b.lastUpdated || b.dateAdded || 0;
                    return new Date(bLastUpdate) - new Date(aLastUpdate);
                });
            }

            sortedCustomers.forEach((customer) => {
                const actualIndex = customers.findIndex(c => c === customer);
                const total = customer.transactions.reduce((sum, t) => sum + t.amount, 0);
                const customerDiv = document.createElement('div');
                customerDiv.className = 'border border-gray-200 rounded-md p-4 cursor-pointer hover:bg-gray-50';
                
                customerDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-3" onclick="toggleCustomerDetails(${actualIndex})">
                        <div>
                            <h3 class="font-semibold text-gray-900 text-lg">${customer.name}</h3>
                            <p class="text-lg font-bold text-red-600 text-left">‚Çπ${Math.round(total)}</p>
                        </div>
                        <div class="flex gap-2" onclick="event.stopPropagation()">
                            <button onclick="addTransaction(${actualIndex})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                + ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                            </button>
                            <button onclick="sendNotice(${actualIndex})" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-sm" title="‡§®‡•ã‡§ü‡§ø‡§∏ ‡§≠‡•á‡§ú‡•á‡§Ç">
                                üì§
                            </button>
                            <div class="relative">
                                <button onclick="toggleCustomerMenu(${actualIndex})" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm customer-menu-btn">
                                    ‚ãÆ
                                </button>
                                <div id="customerMenu${actualIndex}" class="hidden absolute right-0 mt-1 w-32 bg-white rounded-md shadow-lg z-10 border border-gray-200">
                                    <button onclick="printCustomer(${actualIndex})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü
                                    </button>
                                    <button onclick="deleteCustomer(${actualIndex})" class="block w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-gray-100">
                                        ‡§π‡§ü‡§æ‡§è‡§Ç
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="customerDetails${actualIndex}" class="hidden space-y-2 border-t border-gray-200 pt-3">
                        ${customer.transactions.map((t, tIndex) => {
                            let itemsDisplay = '';
                            if (Array.isArray(t.itemsWithAmounts) && t.itemsWithAmounts.length > 0) {
                                itemsDisplay = t.itemsWithAmounts.map(item => `${item.name} (‚Çπ${Math.round(item.amount)})`).join(', ');
                            } else if (Array.isArray(t.items)) {
                                itemsDisplay = t.items.join(', ');
                            } else {
                                itemsDisplay = t.item || '';
                            }
                            
                            return `
                            <div class="text-sm bg-gray-50 p-3 rounded">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="text-left">
                                        <span class="font-bold text-green-600">‚Çπ${Math.round(t.amount)}</span>
                                        <span class="font-medium ml-2">${itemsDisplay}</span>
                                        ${t.buyer && t.buyer !== customer.name ? `<span class="text-gray-600 text-sm ml-2">(${t.buyer})</span>` : ''}
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-500">${new Date(t.date).toLocaleString('hi-IN')}</span>
                                        <button onclick="deleteTransaction(${actualIndex}, ${tIndex})" class="text-red-500 hover:text-red-700">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        }).join('')}
                    </div>
                `;
                customersList.appendChild(customerDiv);
            });
        }

        function toggleCustomerMenu(index) {
            const menu = document.getElementById(`customerMenu${index}`);
            // Close all other menus
            document.querySelectorAll('[id^="customerMenu"]').forEach(m => {
                if (m.id !== `customerMenu${index}`) {
                    m.classList.add('hidden');
                }
            });
            menu.classList.toggle('hidden');
        }

        function deleteCustomer(index) {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                customers.splice(index, 1);
                saveCustomers();
                renderCustomers();
            }
        }

        function deleteTransaction(customerIndex, transactionIndex) {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                customers[customerIndex].transactions.splice(transactionIndex, 1);
                saveCustomers();
                renderCustomers();
            }
        }

        function addTransaction(customerIndex) {
            currentCustomerId = customerIndex;
            const customer = customers[customerIndex];
            document.getElementById('buyerName').placeholder = `‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü: ${customer.name}`;
            
            // Reset form
            document.getElementById('transactionItems').innerHTML = '';
            addTransactionItem();
            updateTotalAmount();
            
            document.getElementById('addTransactionModal').classList.remove('hidden');
        }

        function addTransactionItem() {
            const container = document.getElementById('transactionItems');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'transaction-item border border-gray-200 rounded-md p-3';
            itemDiv.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                    <div>
                        <input type="number" class="w-full p-2 border border-gray-300 rounded-md item-amount" step="0.01" placeholder="‡§∞‡§æ‡§∂‡§ø (‚Çπ)" required>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="text" class="flex-1 p-2 border border-gray-300 rounded-md item-name" placeholder="‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ" required>
                        <button type="button" class="text-red-500 hover:text-red-700 remove-transaction-item" onclick="removeTransactionItem(this)">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="item-list space-y-2">
                    <!-- Additional items will be added here -->
                </div>
            `;
            container.appendChild(itemDiv);
            
            // Add event listeners
            const amountInput = itemDiv.querySelector('.item-amount');
            const nameInput = itemDiv.querySelector('.item-name');
            
            amountInput.addEventListener('input', function() {
                updateTotalAmount();
            });
            
            nameInput.addEventListener('input', function() {
                if (this.value.trim()) {
                    addItemToList(itemDiv);
                }
            });
        }
        
        function addItemToList(parentDiv) {
            const itemList = parentDiv.querySelector('.item-list');
            const existingItems = itemList.querySelectorAll('.additional-item');
            
            // Check if last item is filled
            if (existingItems.length === 0 || existingItems[existingItems.length - 1].querySelector('.additional-item-name').value.trim()) {
                const newItemDiv = document.createElement('div');
                newItemDiv.className = 'additional-item grid grid-cols-1 md:grid-cols-2 gap-3';
                newItemDiv.innerHTML = `
                    <div>
                        <input type="number" class="w-full p-2 border border-gray-300 rounded-md additional-item-amount" step="0.01" placeholder="‡§∞‡§æ‡§∂‡§ø (‚Çπ)">
                    </div>
                    <div>
                        <input type="text" class="w-full p-2 border border-gray-300 rounded-md additional-item-name" placeholder="‡§Ö‡§ó‡§≤‡§æ ‡§∏‡§æ‡§Æ‡§æ‡§® (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)">
                    </div>
                `;
                itemList.appendChild(newItemDiv);
                
                // Add event listeners
                const nameInput = newItemDiv.querySelector('.additional-item-name');
                const amountInput = newItemDiv.querySelector('.additional-item-amount');
                
                nameInput.addEventListener('input', function() {
                    if (this.value.trim()) {
                        addItemToList(parentDiv);
                    }
                });
                
                amountInput.addEventListener('input', function() {
                    updateTotalAmount();
                });
            }
        }

        function removeTransactionItem(button) {
            const items = document.querySelectorAll('.transaction-item');
            if (items.length > 1) {
                button.closest('.transaction-item').remove();
                updateTotalAmount();
            }
        }

        function updateTotalAmount() {
            const mainAmounts = document.querySelectorAll('.item-amount');
            const additionalAmounts = document.querySelectorAll('.additional-item-amount');
            let total = 0;
            
            mainAmounts.forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            
            additionalAmounts.forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            
            document.getElementById('totalAmount').textContent = `‚Çπ${total.toFixed(2)}`;
        }

        function printCustomer(index) {
            const customer = customers[index];
            const total = customer.transactions.reduce((sum, t) => sum + t.amount, 0);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ - ${customer.name}</title>
                    <style>
                        body { font-family: 'Noto Sans Devanagari', Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 20px; }
                        .customer-info { margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .total { font-weight: bold; font-size: 18px; margin-top: 20px; text-align: left; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${shopTitle}</h1>
                        <p>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${new Date().toLocaleDateString('hi-IN')}</p>
                    </div>
                    <div class="customer-info">
                        <h2>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: ${customer.name}</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>‡§∞‡§æ‡§∂‡§ø (‚Çπ)</th>
                                <th>‡§∏‡§æ‡§Æ‡§æ‡§®</th>
                                <th>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§µ ‡§∏‡§Æ‡§Ø</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${customer.transactions.map(t => {
                                let itemsDisplay = '';
                                if (Array.isArray(t.itemsWithAmounts) && t.itemsWithAmounts.length > 0) {
                                    itemsDisplay = t.itemsWithAmounts.map(item => `${item.name}${item.amount > 0 ? ` (‚Çπ${Math.round(item.amount)})` : ''}`).join(', ');
                                } else if (Array.isArray(t.items)) {
                                    itemsDisplay = t.items.join(', ');
                                } else {
                                    itemsDisplay = t.item || '';
                                }
                                
                                return `
                                <tr>
                                    <td style="text-align: left;">‚Çπ${Math.round(t.amount)}</td>
                                    <td style="text-align: left;">${itemsDisplay}${t.buyer && t.buyer !== customer.name ? ` (${t.buyer})` : ''}</td>
                                    <td>${new Date(t.date).toLocaleString('hi-IN')}</td>
                                </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    <div class="total" style="text-align: left;">
                        ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${Math.round(total)}
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Calculator Functions
        let calcDisplay = '';
        let calcSteps = [];

        function appendToDisplay(value) {
            const display = document.getElementById('calcDisplay');
            
            // Prevent multiple consecutive operators
            const operators = ['+', '-', '*', '/'];
            const lastChar = calcDisplay.slice(-1);
            
            if (operators.includes(value) && operators.includes(lastChar)) {
                // Replace the last operator with the new one
                calcDisplay = calcDisplay.slice(0, -1) + value;
            } else if (value === '.' && calcDisplay.includes('.')) {
                // Prevent multiple decimal points in the same number
                const parts = calcDisplay.split(/[+\-*/]/);
                const lastPart = parts[parts.length - 1];
                if (lastPart.includes('.')) {
                    return; // Don't add another decimal point
                }
                calcDisplay += value;
            } else {
                calcDisplay += value;
            }
            
            display.value = calcDisplay;
            updateCalcSteps();
        }

        function clearCalculator() {
            calcDisplay = '';
            calcSteps = [];
            document.getElementById('calcDisplay').value = '';
            document.getElementById('calcStepsContent').textContent = '0';
        }

        function deleteLast() {
            calcDisplay = calcDisplay.slice(0, -1);
            document.getElementById('calcDisplay').value = calcDisplay;
            updateCalcSteps();
        }

        function handleDisplayInput() {
            const display = document.getElementById('calcDisplay');
            let value = display.value;
            
            // Clean the input to prevent invalid characters
            value = value.replace(/[^0-9+\-*/.]/g, '');
            
            // Prevent multiple consecutive operators
            value = value.replace(/([+\-*/]){2,}/g, '$1');
            
            // Prevent multiple decimal points in the same number
            const parts = value.split(/([+\-*/])/);
            for (let i = 0; i < parts.length; i++) {
                if (!/[+\-*/]/.test(parts[i])) {
                    // This is a number part, check for multiple decimal points
                    const decimalCount = (parts[i].match(/\./g) || []).length;
                    if (decimalCount > 1) {
                        // Keep only the first decimal point
                        const firstDecimalIndex = parts[i].indexOf('.');
                        parts[i] = parts[i].substring(0, firstDecimalIndex + 1) + parts[i].substring(firstDecimalIndex + 1).replace(/\./g, '');
                    }
                }
            }
            value = parts.join('');
            
            calcDisplay = value;
            display.value = calcDisplay;
            updateCalcSteps();
        }

        function handleKeyDown(event) {
            // Allow Enter key to calculate
            if (event.key === 'Enter') {
                event.preventDefault();
                calculate();
                return;
            }
            
            // Allow control keys
            const controlKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Home', 'End', 'Tab'];
            if (controlKeys.includes(event.key) || event.ctrlKey) {
                return;
            }
            
            // Allow only numbers, operators, and decimal point
            const allowedKeys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '-', '*', '/', '.'];
            if (!allowedKeys.includes(event.key)) {
                event.preventDefault();
                return;
            }
            
            // Prevent multiple consecutive operators
            const operators = ['+', '-', '*', '/'];
            const currentValue = event.target.value;
            const lastChar = currentValue.slice(-1);
            
            if (operators.includes(event.key) && operators.includes(lastChar)) {
                event.preventDefault();
                return;
            }
            
            // Prevent multiple decimal points in current number
            if (event.key === '.') {
                const parts = currentValue.split(/[+\-*/]/);
                const lastPart = parts[parts.length - 1];
                if (lastPart.includes('.')) {
                    event.preventDefault();
                    return;
                }
            }
        }

        function updateCalcSteps() {
            const stepsContent = document.getElementById('calcStepsContent');
            if (calcDisplay) {
                try {
                    // Try to evaluate intermediate results
                    let expression = calcDisplay.replace(/√ó/g, '*');
                    
                    // Handle incomplete expressions (ending with operators)
                    let cleanExpression = expression;
                    if (/[+\-*/]$/.test(expression)) {
                        cleanExpression = expression.slice(0, -1);
                    }
                    
                    if (cleanExpression && cleanExpression.trim() && cleanExpression !== '0') {
                        // Validate expression
                        if (!/^[0-9+\-*/.() ]+$/.test(cleanExpression)) {
                            stepsContent.textContent = calcDisplay || '0';
                            return;
                        }
                        
                        // Check for division by zero
                        if (cleanExpression.includes('/0')) {
                            stepsContent.textContent = `${calcDisplay} = Error`;
                            return;
                        }
                        
                        const result = eval(cleanExpression);
                        
                        // Check if result is valid
                        if (isNaN(result) || !isFinite(result)) {
                            stepsContent.textContent = calcDisplay || '0';
                            return;
                        }
                        
                        const roundedResult = Math.round(result);
                        stepsContent.textContent = `${calcDisplay} = ${roundedResult}`;
                    } else {
                        stepsContent.textContent = calcDisplay || '0';
                    }
                } catch (e) {
                    stepsContent.textContent = calcDisplay || '0';
                }
            } else {
                stepsContent.textContent = '0';
            }
        }

        function calculate() {
            try {
                let expression = calcDisplay.replace(/√ó/g, '*');
                
                // Handle incomplete expressions (ending with operators)
                if (/[+\-*/]$/.test(expression)) {
                    expression = expression.slice(0, -1);
                }
                
                // Check for empty or invalid expression
                if (!expression || !expression.trim() || expression === '0') {
                    document.getElementById('calcStepsContent').textContent = '0';
                    return;
                }
                
                // Validate expression before evaluation
                if (!/^[0-9+\-*/.() ]+$/.test(expression)) {
                    updateCalcSteps();
                    return;
                }
                
                // Check for division by zero
                if (expression.includes('/0')) {
                    document.getElementById('calcStepsContent').textContent = 'Error: Division by zero';
                    return;
                }
                
                const result = eval(expression);
                
                // Check if result is valid
                if (isNaN(result) || !isFinite(result)) {
                    document.getElementById('calcStepsContent').textContent = 'Error';
                    return;
                }
                
                // Round result and update display
                const roundedResult = Math.round(result);
                calcDisplay = roundedResult.toString();
                document.getElementById('calcDisplay').value = calcDisplay;
                document.getElementById('calcStepsContent').textContent = roundedResult;
                
            } catch (error) {
                // Show error in steps without changing display
                document.getElementById('calcStepsContent').textContent = 'Error';
            }
        }

        function openCalcToBahikhata() {
            const amount = parseFloat(calcDisplay);
            if (!amount || amount <= 0) {
                alert('‡§™‡§π‡§≤‡•á ‡§ï‡•ã‡§à ‡§∞‡§æ‡§∂‡§ø calculate ‡§ï‡§∞‡•á‡§Ç');
                return;
            }
            
            // Update customer dropdown
            const dropdown = document.getElementById('calcCustomerDropdown');
            dropdown.innerHTML = '';
            customers.forEach((customer, index) => {
                const option = document.createElement('div');
                option.className = 'px-3 py-2 hover:bg-gray-100 cursor-pointer';
                option.textContent = customer.name;
                option.onclick = () => selectCustomer(customer.name, index);
                dropdown.appendChild(option);
            });
            
            document.getElementById('calcCustomerInput').value = '';
            document.getElementById('calcAmount').value = Math.round(amount);
            document.getElementById('calcToBahikhataModal').classList.remove('hidden');
        }

        function openCalcHistory() {
            renderCalcHistory();
            document.getElementById('calcHistoryModal').classList.remove('hidden');
        }

        function renderCalcHistory() {
            const historyContent = document.getElementById('calcHistoryContent');
            historyContent.innerHTML = '';

            if (calcHistory.length === 0) {
                historyContent.innerHTML = '<p class="text-gray-500 text-center py-4">‡§ï‡•ã‡§à ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä</p>';
                return;
            }

            calcHistory.slice().reverse().forEach((entry, index) => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'border border-gray-200 rounded-md p-3 bg-gray-50';
                historyDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-semibold text-green-600">‚Çπ${entry.amount}</span>
                            <span class="text-sm text-gray-600 ml-2">${new Date(entry.date).toLocaleString('hi-IN')}</span>
                        </div>
                    </div>
                    <div class="text-sm">
                        <div><strong>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï:</strong> ${entry.customerName}</div>
                        <div><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${entry.description}</div>
                    </div>
                `;
                historyContent.appendChild(historyDiv);
            });
        }

        function saveCalcHistory() {
            localStorage.setItem('calcHistory', JSON.stringify(calcHistory));
        }

        function clearCalcHistory() {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡§≠‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                calcHistory = [];
                saveCalcHistory();
                renderCalcHistory();
            }
        }

        function selectCustomer(name, index) {
            document.getElementById('calcCustomerInput').value = name;
            document.getElementById('calcCustomerInput').dataset.customerIndex = index;
            document.getElementById('calcCustomerDropdown').classList.add('hidden');
        }

        function toggleCustomerDetails(index) {
            const details = document.getElementById(`customerDetails${index}`);
            const isHidden = details.classList.contains('hidden');
            
            // Close all other customer details
            document.querySelectorAll('[id^="customerDetails"]').forEach(d => {
                if (d.id !== `customerDetails${index}`) {
                    d.classList.add('hidden');
                }
            });
            
            // Toggle current customer details
            details.classList.toggle('hidden');
            
            // Show/hide menu buttons based on dropdown state
            const menuBtn = document.querySelector(`button[onclick="toggleCustomerMenu(${index})"]`);
            if (details.classList.contains('hidden')) {
                // Dropdown is closed - hide menu button
                menuBtn.style.display = 'none';
            } else {
                // Dropdown is open - show menu button
                menuBtn.style.display = 'inline-block';
            }
        }

        function confirmDeleteItem(index) {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                items.splice(index, 1);
                saveItems();
                renderItems();
            }
        }

        function addVariantRow(type = '‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', price = '') {
            const variantsContainer = document.getElementById('priceVariants');
            const variantDiv = document.createElement('div');
            variantDiv.className = 'flex gap-2 items-center price-variant';
            variantDiv.innerHTML = `
                <input type="number" class="w-32 p-2 border border-gray-300 rounded-md variant-price" placeholder="‡§¶‡§∞ (‚Çπ)" value="${price}">
                <select class="flex-1 p-2 border border-gray-300 rounded-md variant-type">
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞</option>
                    <option value="‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞" ${type === '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞' ? 'selected' : ''}>‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞</option>
                    <option value="‡§Ö‡§®‡•ç‡§Ø" ${!['‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó', '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®', '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü', '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞', '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞'].includes(type) ? 'selected' : ''}>‡§Ö‡§®‡•ç‡§Ø</option>
                </select>
                <input type="text" class="flex-1 p-2 border border-gray-300 rounded-md custom-type ${!['‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó', '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®', '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü', '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞', '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞'].includes(type) ? '' : 'hidden'}" placeholder="‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞" value="${!['‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡§ø‡§≤‡•ã', '‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§ó', '‡§™‡•ç‡§∞‡§§‡§ø ‡§¶‡§∞‡•ç‡§ú‡§®', '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•à‡§ï‡•á‡§ü', '‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞', '‡§™‡•ç‡§∞‡§§‡§ø ‡§Æ‡•Ä‡§ü‡§∞'].includes(type) ? type : ''}">
                <button type="button" class="text-red-500 hover:text-red-700 remove-variant" onclick="removeVariant(this)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;
            variantsContainer.appendChild(variantDiv);
            
            // Add event listener for variant type change
            const select = variantDiv.querySelector('.variant-type');
            const customInput = variantDiv.querySelector('.custom-type');
            
            select.addEventListener('change', function() {
                if (this.value === '‡§Ö‡§®‡•ç‡§Ø') {
                    customInput.classList.remove('hidden');
                } else {
                    customInput.classList.add('hidden');
                    customInput.value = '';
                }
            });
        }

        function sendNotice(customerIndex) {
            const customer = customers[customerIndex];
            const total = customer.transactions.reduce((sum, t) => sum + t.amount, 0);
            
            const noticeContent = document.getElementById('noticeContent');
            noticeContent.innerHTML = `
                <div class="text-center mb-4">
                    <h2 class="text-xl font-bold">${shopTitle}</h2>
                    <p class="text-sm text-gray-600">‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§∏</p>
                    <p class="text-sm text-gray-600">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${new Date().toLocaleDateString('hi-IN')}</p>
                </div>
                <div class="border-t border-b border-gray-300 py-4 my-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ:</span>
                        <span class="font-bold">${customer.name}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-medium">‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø:</span>
                        <span class="font-bold text-red-600 text-xl">‚Çπ${Math.round(total)}</span>
                    </div>
                </div>
                <div class="text-center text-sm text-gray-600">
                    <p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§≤‡•ç‡§¶ ‡§∏‡•á ‡§ú‡§≤‡•ç‡§¶ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                    <p>‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                </div>
            `;
            
            document.getElementById('sendNoticeModal').classList.remove('hidden');
        }

        // Menu Functions
        function printAllItems() {
            if (items.length === 0) {
                alert('‡§ï‡•ã‡§à ‡§µ‡§∏‡•ç‡§§‡•Å ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä');
                return;
            }

            const printWindow = window.open('', '_blank');
            let itemsHtml = '';
            let serialNo = 1;
            
            items.forEach(item => {
                if (item.variants && item.variants.length > 0) {
                    item.variants.forEach(variant => {
                        itemsHtml += `
                            <tr>
                                <td>${serialNo++}</td>
                                <td>${item.name}</td>
                                <td>${variant.type}</td>
                                <td>‚Çπ${variant.price}</td>
                            </tr>
                        `;
                    });
                } else {
                    // Legacy support
                    itemsHtml += `
                        <tr>
                            <td>${serialNo++}</td>
                            <td>${item.name}</td>
                            <td>${item.type || '‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø'}</td>
                            <td>‚Çπ${item.price}</td>
                        </tr>
                    `;
                }
            });

            printWindow.document.write(`
                <html>
                <head>
                    <title>‡§∏‡§≠‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</title>
                    <style>
                        body { font-family: 'Noto Sans Devanagari', Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${shopTitle} - ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•Ä ‡§¶‡§∞ ‡§∏‡•Ç‡§ö‡•Ä</h1>
                        <p>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${new Date().toLocaleDateString('hi-IN')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>‡§ï‡•ç‡§∞‡§Æ</th>
                                <th>‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡§æ ‡§®‡§æ‡§Æ</th>
                                <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
                                <th>‡§¶‡§∞ (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function printBahikhata() {
            if (customers.length === 0) {
                alert('‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ');
                return;
            }

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</title>
                    <style>
                        body { font-family: 'Noto Sans Devanagari', Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .total { font-weight: bold; font-size: 18px; margin-top: 20px; text-align: left; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${shopTitle} - ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h1>
                        <p>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${new Date().toLocaleDateString('hi-IN')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>‡§ï‡•ç‡§∞‡§Æ</th>
                                <th>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ</th>
                                <th>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${customers.map((customer, index) => {
                                const total = customer.transactions.reduce((sum, t) => sum + t.amount, 0);
                                return `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${customer.name}</td>
                                        <td>‚Çπ${total.toFixed(2)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    <div class="total">
                        ‡§ï‡•Å‡§≤ ‡§â‡§ß‡§æ‡§∞‡•Ä: ‚Çπ${customers.reduce((sum, customer) => {
                            return sum + customer.transactions.reduce((cSum, t) => cSum + t.amount, 0);
                        }, 0).toFixed(2)}
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function printDetailedBahikhata() {
            if (customers.length === 0) {
                alert('‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ');
                return;
            }

            const printWindow = window.open('', '_blank');
            let customersHtml = '';
            let grandTotal = 0;

            customers.forEach(customer => {
                const customerTotal = customer.transactions.reduce((sum, t) => sum + t.amount, 0);
                grandTotal += customerTotal;

                customersHtml += `
                    <div class="customer-section">
                        <h3>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: ${customer.name}</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>‡§∞‡§æ‡§∂‡§ø (‚Çπ)</th>
                                    <th>‡§∏‡§æ‡§Æ‡§æ‡§®</th>
                                    <th>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§µ ‡§∏‡§Æ‡§Ø</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${customer.transactions.map(t => {
                                    let itemsDisplay = '';
                                    if (Array.isArray(t.itemsWithAmounts) && t.itemsWithAmounts.length > 0) {
                                        itemsDisplay = t.itemsWithAmounts.map(item => `${item.name}${item.amount > 0 ? ` (‚Çπ${Math.round(item.amount)})` : ''}`).join(', ');
                                    } else if (Array.isArray(t.items)) {
                                        itemsDisplay = t.items.join(', ');
                                    } else {
                                        itemsDisplay = t.item || '';
                                    }
                                    
                                    return `
                                    <tr>
                                        <td style="text-align: left;">‚Çπ${Math.round(t.amount)}</td>
                                        <td style="text-align: left;">${itemsDisplay}${t.buyer && t.buyer !== customer.name ? ` (${t.buyer})` : ''}</td>
                                        <td>${new Date(t.date).toLocaleString('hi-IN')}</td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                        <div class="customer-total" style="text-align: left;">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•Å‡§≤: ‚Çπ${Math.round(customerTotal)}</div>
                    </div>
                `;
            });

            printWindow.document.write(`
                <html>
                <head>
                    <title>‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ</title>
                    <style>
                        body { font-family: 'Noto Sans Devanagari', Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 20px; }
                        .customer-section { margin-bottom: 30px; page-break-inside: avoid; }
                        .customer-section h3 { background-color: #f0f0f0; padding: 10px; margin: 0 0 10px 0; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .customer-total { font-weight: bold; text-align: right; margin-bottom: 20px; }
                        .grand-total { font-weight: bold; font-size: 18px; margin-top: 20px; text-align: center; background-color: #e0e0e0; padding: 15px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${shopTitle} - ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ</h1>
                        <p>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${new Date().toLocaleDateString('hi-IN')}</p>
                    </div>
                    ${customersHtml}
                    <div class="grand-total" style="text-align: left;">
                        ‡§ï‡•Å‡§≤ ‡§â‡§ß‡§æ‡§∞‡•Ä: ‚Çπ${Math.round(grandTotal)}
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            initShopTitle();
            initTheme();
            initTabs();
            renderItems();
            renderCustomers();

            // Menu toggle
            document.getElementById('menuBtn').addEventListener('click', function() {
                const dropdown = document.getElementById('menuDropdown');
                dropdown.classList.toggle('hidden');
            });

            // Close menu when clicking outside
            document.addEventListener('click', function(e) {
                const menu = document.getElementById('menuBtn');
                const dropdown = document.getElementById('menuDropdown');
                if (!menu.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
                
                // Close customer menus
                document.querySelectorAll('[id^="customerMenu"]').forEach(m => {
                    if (!e.target.closest(`#${m.id}`) && !e.target.closest(`button[onclick*="toggleCustomerMenu"]`)) {
                        m.classList.add('hidden');
                    }
                });
            });

            // Theme selector
            document.getElementById('themeSelect').addEventListener('change', function() {
                applyTheme(this.value);
            });

            // Menu actions
            document.getElementById('printAllItems').addEventListener('click', function() {
                printAllItems();
                document.getElementById('menuDropdown').classList.add('hidden');
            });
            
            document.getElementById('printBahikhata').addEventListener('click', function() {
                printBahikhata();
                document.getElementById('menuDropdown').classList.add('hidden');
            });
            
            document.getElementById('printDetailedBahikhata').addEventListener('click', function() {
                printDetailedBahikhata();
                document.getElementById('menuDropdown').classList.add('hidden');
            });
            
            document.getElementById('editTitle').addEventListener('click', function() {
                editShopTitle();
                document.getElementById('menuDropdown').classList.add('hidden');
            });

            // Edit title modal
            document.getElementById('editTitleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newTitle = document.getElementById('newShopTitle').value.trim();
                if (newTitle) {
                    shopTitle = newTitle;
                    localStorage.setItem('shopTitle', shopTitle);
                    document.getElementById('shopTitle').textContent = shopTitle;
                    document.getElementById('editTitleModal').classList.add('hidden');
                }
            });

            document.getElementById('cancelEditTitle').addEventListener('click', function() {
                document.getElementById('editTitleModal').classList.add('hidden');
            });

            // Add item modal
            document.getElementById('addItemBtn').addEventListener('click', function() {
                resetItemForm();
                addVariantRow();
                document.getElementById('addItemModal').classList.remove('hidden');
            });

            document.getElementById('cancelAddItem').addEventListener('click', function() {
                document.getElementById('addItemModal').classList.add('hidden');
                resetItemForm();
            });

            // Send Notice modal
            document.getElementById('cancelNotice').addEventListener('click', function() {
                document.getElementById('sendNoticeModal').classList.add('hidden');
            });

            document.getElementById('printNotice').addEventListener('click', function() {
                const noticeContent = document.getElementById('noticeContent').innerHTML;
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§∏</title>
                        <style>
                            @page {
                                size: A4;
                                margin: 15mm;
                            }
                            body { 
                                font-family: 'Noto Sans Devanagari', Arial, sans-serif; 
                                margin: 0;
                                padding: 0;
                                width: 100%;
                                height: 100vh;
                                background: white;
                                color: black;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                            }
                            .notice-container {
                                width: 160mm;
                                max-width: 160mm;
                                padding: 40px;
                                border: 3px solid #333;
                                border-radius: 12px;
                                background: white;
                                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                            }
                            .text-center { text-align: center; }
                            .text-xl { font-size: 1.8rem; line-height: 1.4; }
                            .text-lg { font-size: 1.4rem; line-height: 1.3; }
                            .text-sm { font-size: 1rem; line-height: 1.2; }
                            .font-bold { font-weight: bold; }
                            .font-medium { font-weight: 500; }
                            .mb-4 { margin-bottom: 1.5rem; }
                            .mb-2 { margin-bottom: 0.8rem; }
                            .my-4 { margin-top: 1.5rem; margin-bottom: 1.5rem; }
                            .py-4 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
                            .border-t { border-top: 2px solid #333; }
                            .border-b { border-bottom: 2px solid #333; }
                            .text-gray-600 { color: #555; }
                            .text-red-600 { color: #dc2626; font-size: 1.6rem; }
                            .flex { display: flex; }
                            .justify-between { justify-content: space-between; }
                            .items-center { align-items: center; }
                        </style>
                    </head>
                    <body>
                        <div class="notice-container">
                            ${noticeContent}
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            });

            document.getElementById('saveNoticeImage').addEventListener('click', function() {
                // Get the notice content
                const noticeContent = document.getElementById('noticeContent');
                
                // Create a high-quality canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set high resolution canvas size (A4 proportions)
                const scale = 3; // For high quality
                canvas.width = 600 * scale;
                canvas.height = 800 * scale;
                ctx.scale(scale, scale);
                
                // Fill white background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, 600, 800);
                
                // Draw border
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.strokeRect(30, 50, 540, 700);
                
                // Set text properties
                ctx.fillStyle = 'black';
                ctx.textAlign = 'center';
                
                // Shop title
                ctx.font = 'bold 28px Arial';
                ctx.fillText(shopTitle, 300, 120);
                
                // Notice title
                ctx.font = '18px Arial';
                ctx.fillStyle = '#666';
                ctx.fillText('‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§∏', 300, 150);
                
                // Date
                ctx.font = '16px Arial';
                ctx.fillText(`‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${new Date().toLocaleDateString('hi-IN')}`, 300, 180);
                
                // Extract customer name and amount from notice content
                const customerNameMatch = noticeContent.innerHTML.match(/‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ:<\/span>\s*<span[^>]*>([^<]+)<\/span>/);
                const amountMatch = noticeContent.innerHTML.match(/‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø:<\/span>\s*<span[^>]*>([^<]+)<\/span>/);
                
                const customerName = customerNameMatch ? customerNameMatch[1] : 'N/A';
                const amount = amountMatch ? amountMatch[1] : '‚Çπ0';
                
                // Draw horizontal line
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(80, 220);
                ctx.lineTo(520, 220);
                ctx.stroke();
                
                // Customer details
                ctx.fillStyle = 'black';
                ctx.font = '20px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ:', 80, 270);
                ctx.font = 'bold 22px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(customerName, 520, 270);
                
                ctx.font = '20px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø:', 80, 320);
                ctx.font = 'bold 32px Arial';
                ctx.fillStyle = '#dc2626';
                ctx.textAlign = 'right';
                ctx.fillText(amount, 520, 320);
                
                // Draw horizontal line
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(80, 350);
                ctx.lineTo(520, 350);
                ctx.stroke();
                
                // Footer message
                ctx.fillStyle = '#666';
                ctx.font = '18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§≤‡•ç‡§¶ ‡§∏‡•á ‡§ú‡§≤‡•ç‡§¶ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§', 300, 420);
                ctx.fillText('‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!', 300, 450);
                
                // Convert to blob and download
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `payment-notice-${customerName.replace(/\s+/g, '-')}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 'image/png', 1.0);
            });

            document.getElementById('addItemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('itemName').value.trim();
                
                if (!name) {
                    alert('‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à');
                    return;
                }
                
                // Collect all variants
                const variants = [];
                const variantElements = document.querySelectorAll('.price-variant');
                
                variantElements.forEach(element => {
                    const priceInput = element.querySelector('.variant-price');
                    const typeSelect = element.querySelector('.variant-type');
                    const customInput = element.querySelector('.custom-type');
                    
                    let type = typeSelect.value;
                    if (type === '‡§Ö‡§®‡•ç‡§Ø' && customInput.value.trim()) {
                        type = customInput.value.trim();
                    }
                    
                    const price = parseFloat(priceInput.value);
                    
                    if (type && price > 0) {
                        variants.push({ type, price: Math.round(price) });
                    }
                });

                // If no variants with price, create one with just type
                if (variants.length === 0) {
                    const firstVariant = variantElements[0];
                    if (firstVariant) {
                        const typeSelect = firstVariant.querySelector('.variant-type');
                        const customInput = firstVariant.querySelector('.custom-type');
                        
                        let type = typeSelect.value;
                        if (type === '‡§Ö‡§®‡•ç‡§Ø' && customInput.value.trim()) {
                            type = customInput.value.trim();
                        }
                        
                        variants.push({ type, price: 0 });
                    }
                }

                const itemData = { 
                    name, 
                    variants,
                    dateAdded: editingItemIndex !== null ? items[editingItemIndex].dateAdded : new Date().toISOString()
                };

                if (editingItemIndex !== null) {
                    items[editingItemIndex] = itemData;
                } else {
                    items.push(itemData);
                }

                saveItems();
                renderItems();
                document.getElementById('addItemModal').classList.add('hidden');
                resetItemForm();
            });

            // Add variant button
            document.getElementById('addVariant').addEventListener('click', function() {
                addVariantRow();
            });

            // Add customer modal
            document.getElementById('addCustomerBtn').addEventListener('click', function() {
                document.getElementById('addCustomerModal').classList.remove('hidden');
            });

            document.getElementById('cancelAddCustomer').addEventListener('click', function() {
                document.getElementById('addCustomerModal').classList.add('hidden');
                document.getElementById('addCustomerForm').reset();
            });

            document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('customerName').value.trim();

                if (name) {
                    customers.push({ 
                        name, 
                        transactions: [],
                        dateAdded: new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    });
                    saveCustomers();
                    renderCustomers();
                    document.getElementById('addCustomerModal').classList.add('hidden');
                    this.reset();
                }
            });

            // Add transaction modal
            document.getElementById('cancelAddTransaction').addEventListener('click', function() {
                document.getElementById('addTransactionModal').classList.add('hidden');
            });

            document.getElementById('addTransactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const buyerName = document.getElementById('buyerName').value.trim() || customers[currentCustomerId].name;
                const transactionItems = document.querySelectorAll('.transaction-item');
                
                // Collect all items and amounts for a single transaction
                const allItemsWithAmounts = [];
                let totalTransactionAmount = 0;
                
                transactionItems.forEach(item => {
                    const mainItemName = item.querySelector('.item-name').value.trim();
                    const mainAmount = parseFloat(item.querySelector('.item-amount').value) || 0;
                    
                    if (mainItemName) {
                        if (mainAmount > 0) {
                            allItemsWithAmounts.push({ name: mainItemName, amount: mainAmount });
                            totalTransactionAmount += mainAmount;
                        } else {
                            // If no amount specified, add item without amount
                            allItemsWithAmounts.push({ name: mainItemName, amount: 0 });
                        }
                    }
                    
                    // Collect additional items
                    const additionalItems = item.querySelectorAll('.additional-item');
                    additionalItems.forEach(additionalItem => {
                        const additionalName = additionalItem.querySelector('.additional-item-name').value.trim();
                        const additionalAmount = parseFloat(additionalItem.querySelector('.additional-item-amount').value) || 0;
                        
                        if (additionalName) {
                            allItemsWithAmounts.push({ name: additionalName, amount: additionalAmount });
                            totalTransactionAmount += additionalAmount;
                        }
                    });
                });
                
                if (allItemsWithAmounts.length > 0) {
                    const transaction = {
                        itemsWithAmounts: allItemsWithAmounts,
                        items: allItemsWithAmounts.map(item => item.name), // For backward compatibility
                        item: allItemsWithAmounts.map(item => item.name).join(', '), // For backward compatibility
                        amount: Math.round(totalTransactionAmount),
                        buyer: buyerName,
                        date: new Date().toISOString()
                    };
                    
                    customers[currentCustomerId].transactions.push(transaction);
                    
                    // Update customer's last updated time
                    customers[currentCustomerId].lastUpdated = new Date().toISOString();
                    
                    saveCustomers();
                    renderCustomers();
                    document.getElementById('addTransactionModal').classList.add('hidden');
                }
            });

            // Search functionality for items
            document.getElementById('searchItemBtn').addEventListener('click', function() {
                const container = document.getElementById('itemSearchContainer');
                const input = document.getElementById('itemSearchInput');
                container.classList.toggle('hidden');
                if (!container.classList.contains('hidden')) {
                    input.focus();
                } else {
                    input.value = '';
                    filteredItems = [];
                    renderItems();
                }
            });

            document.getElementById('itemSearchInput').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                if (searchTerm) {
                    filteredItems = items.filter(item => 
                        item.name.toLowerCase().includes(searchTerm) ||
                        (item.variants && item.variants.some(v => v.type.toLowerCase().includes(searchTerm)))
                    );
                } else {
                    filteredItems = [];
                }
                renderItems();
            });

            // Search functionality for customers
            document.getElementById('searchCustomerBtn').addEventListener('click', function() {
                const container = document.getElementById('customerSearchContainer');
                const input = document.getElementById('customerSearchInput');
                container.classList.toggle('hidden');
                if (!container.classList.contains('hidden')) {
                    input.focus();
                } else {
                    input.value = '';
                    filteredCustomers = [];
                    renderCustomers();
                }
            });

            document.getElementById('customerSearchInput').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                if (searchTerm) {
                    filteredCustomers = customers.filter(customer => 
                        customer.name.toLowerCase().includes(searchTerm)
                    );
                } else {
                    filteredCustomers = [];
                }
                renderCustomers();
            });

            // Sort button functionality
            document.getElementById('sortItemBtn').addEventListener('click', function() {
                const select = document.getElementById('itemSortOrder');
                select.classList.toggle('hidden');
            });

            document.getElementById('sortCustomerBtn').addEventListener('click', function() {
                const select = document.getElementById('customerSortOrder');
                select.classList.toggle('hidden');
            });

            // Calculator history modal
            document.getElementById('closeCalcHistory').addEventListener('click', function() {
                document.getElementById('calcHistoryModal').classList.add('hidden');
            });

            document.getElementById('clearCalcHistory').addEventListener('click', clearCalcHistory);

            // Sort order change listeners
            document.getElementById('itemSortOrder').addEventListener('change', function() {
                this.classList.add('hidden');
                renderItems();
            });
            
            document.getElementById('customerSortOrder').addEventListener('change', function() {
                this.classList.add('hidden');
                renderCustomers();
            });

            // Calculator customer input
            document.getElementById('calcCustomerInput').addEventListener('input', function() {
                const dropdown = document.getElementById('calcCustomerDropdown');
                const value = this.value.toLowerCase();
                
                if (value) {
                    dropdown.classList.remove('hidden');
                    const options = dropdown.querySelectorAll('div');
                    options.forEach(option => {
                        if (option.textContent.toLowerCase().includes(value)) {
                            option.style.display = 'block';
                        } else {
                            option.style.display = 'none';
                        }
                    });
                } else {
                    dropdown.classList.add('hidden');
                }
            });

            document.getElementById('calcCustomerInput').addEventListener('focus', function() {
                if (customers.length > 0) {
                    document.getElementById('calcCustomerDropdown').classList.remove('hidden');
                }
            });

            // Calculator to Bahikhata modal
            document.getElementById('cancelCalcToBahikhata').addEventListener('click', function() {
                document.getElementById('calcToBahikhataModal').classList.add('hidden');
            });

            document.getElementById('calcToBahikhataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const customerName = document.getElementById('calcCustomerInput').value.trim();
                const amount = Math.round(parseFloat(document.getElementById('calcAmount').value));
                const description = document.getElementById('calcItemDescription').value.trim() || '‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞ ‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ';
                
                if (customerName && amount > 0) {
                    // Find existing customer or create new one
                    let customerIndex = customers.findIndex(c => c.name === customerName);
                    
                    if (customerIndex === -1) {
                        // Create new customer
                        customers.push({
                            name: customerName,
                            transactions: [],
                            dateAdded: new Date().toISOString(),
                            lastUpdated: new Date().toISOString()
                        });
                        customerIndex = customers.length - 1;
                    } else {
                        // Update existing customer's last updated time
                        customers[customerIndex].lastUpdated = new Date().toISOString();
                    }
                    
                    const transaction = {
                        itemsWithAmounts: [{ name: description, amount: amount }],
                        items: [description], // For backward compatibility
                        item: description, // For backward compatibility
                        amount: amount,
                        buyer: customerName,
                        date: new Date().toISOString()
                    };
                    
                    customers[customerIndex].transactions.push(transaction);
                    
                    // Add to calculator history
                    calcHistory.push({
                        customerName: customerName,
                        amount: amount,
                        description: description,
                        date: new Date().toISOString()
                    });
                    
                    saveCustomers();
                    saveCalcHistory();
                    renderCustomers();
                    
                    document.getElementById('calcToBahikhataModal').classList.add('hidden');
                    document.getElementById('calcItemDescription').value = '';
                    document.getElementById('calcCustomerInput').value = '';
                    
                    alert('‡§∞‡§æ‡§∂‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§π‡•Ä‡§ñ‡§æ‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º ‡§¶‡•Ä ‡§ó‡§à!');
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c9911b612a80bb',t:'MTc1NDc2Njc2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
